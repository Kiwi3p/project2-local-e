
<div class="profile-container">
    <section class="profile-information dark-background">
          <article class="container profile-info map">
            <div class="map-search">
            <h3>Map</h3>
            <form>
              <label>
                <input type="text" name="location" placeholder="Enter location" required>
              </label>
            </form>
            <button type="submit" onclick="getCurrentLocation()">Get current location</button>
            </div>
            <div id="map"></div>
          </article>
          <article class="container profile-info">
            <h3>Favorite Shops!</h3>
            <p class="text-look">Favorite shops go here</p>
            <a class="link-btn" href="#">Test Link</a>
          </article>
          <article class="container profile-info">
            <h3>Favorite Farmers Markets</h3>
            <p class="text-look">Transit options go here</p>
            <a class="link-btn" href="#">Test Link</a>
          </article>
    </section>
</div>
<input type="hidden" id="storeLocationInput" value={{thisLocation}}>

<script>
  //ONLOAD 
  let map;
  function initMap() {
    let savedLocation = JSON.parse(document.getElementById('storeLocationInput').value);
    map = new google.maps.Map(document.getElementById("map"), {
      zoom: 13,
      center: savedLocation
    });
    searchPlaces();
  } 
  function searchPlaces() {
      let savedLocation = JSON.parse(document.getElementById('storeLocationInput').value);
      let request = {
        location: savedLocation,
        query: ['market', 'bio']

      }
      let service = new google.maps.places.PlacesService(map);
      service.textSearch(request, (results, status) => {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          for (let i = 0; i < results.length; i++) {
            let name = results[i].name;
            let address = results[i].formatted_address;
            let place_id = results[i].place_id;
           let lat = results[i].geometry.location.lat();
           let lng = results[i].geometry.location.lng();
            setMarker({ lat, lng }, name);
            console.log(results[i]);
          }
          
        }
      });
    }

   
  function setMarker(marker, name) {
    // console.log(‘marker’, marker);
    let customMarker = new google.maps.Marker({
      position: marker,
      map: map
    });
    const infowindow = new google.maps.InfoWindow({
      content: name,
    });
    customMarker.addListener("click", () => {
      infowindow.open(map, customMarker);
    });
  }


  function getCurrentLocation() {
  navigator.geolocation.getCurrentPosition((position) => {
  const pos = {
  lat: position.coords.latitude,
  lng: position.coords.longitude
  }
  map.setCenter(pos);
  map.setZoom(17);
  //showMarkers(markers);
  });
  }   
</script>
